<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سجل الحضور والغياب - مدارِك</title>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'arabic': ['Cairo', 'Arial', 'sans-serif']
                    },
                    colors: {
                        'primary': '#0984e3',
                        'primary-dark': '#74b9ff',
                        'secondary': '#00b894',
                        'accent': '#6c5ce7',
                        'success': '#55efc4',
                        'warning': '#fdcb6e',
                        'danger': '#e17055',
                        'pink': '#fd79a8',
                        'info': '#00cec9',
                        'purple': '#a29bfe',
                        'orange': '#ff7675',
                        'background': '#f8f9fa',
                        'card': '#ffffff',
                        'text-primary': '#2d3436',
                        'text-secondary': '#636e72',
                        'border': '#ddd',
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="icon" href="https://r2.flowith.net/files/o/1748451765656-Modern_Logo_Design_for_Madarek_School_Management_Platform_index_0@1024x1024.png" type="image/png">
</head>
<body class="font-arabic bg-background text-text-primary">
<div class="flex h-screen">
    <!-- Sidebar -->
    <nav class="hidden lg:flex lg:flex-shrink-0 shadow-sm" id="sidebarNav" style="background-color: #1a2b4a;">
        <div class="flex flex-col w-64">
            <div class="flex items-center justify-center h-20 border-b border-white/10 px-4">
                <img src="https://r2.flowith.net/files/o/1748451765656-Modern_Logo_Design_for_Madarek_School_Management_Platform_index_0@1024x1024.png" alt="مدارك" class="h-10 w-auto rounded-full">
                <span class="mr-3 text-2xl font-bold text-white">مدارِك</span>
            </div>
            <div class="flex-grow mt-5 overflow-y-auto">
                <nav class="px-4">
                    <ul class="space-y-1">
                        <li><a href="index.html" class="sidebar-link group flex items-center px-3 py-3 text-base font-semibold rounded-lg"><i data-lucide="layout-dashboard" class="ml-3 h-5 w-5"></i>لوحة التحكم</a></li>
                        <li><a href="lessons.html" class="sidebar-link group flex items-center px-3 py-3 text-base rounded-lg"><i data-lucide="book-open" class="ml-3 h-5 w-5"></i>الدروس والمواد</a></li>
                        <li><a href="schedule.html" class="sidebar-link group flex items-center px-3 py-3 text-base rounded-lg"><i data-lucide="calendar-days" class="ml-3 h-5 w-5"></i>الجدول الدراسي</a></li>
                        <li><a href="attendence.html" class="sidebar-link group flex items-center px-3 py-3 text-base rounded-lg active"><i data-lucide="calendar-check" class="ml-3 h-5 w-5"></i>الحضور</a></li>
                        <li><a href="grades.html" class="sidebar-link group flex items-center px-3 py-3 text-base rounded-lg"><i data-lucide="bar-chart-3" class="ml-3 h-5 w-5"></i>الصحيفة</a></li>
                        <li><a href="profile.html" class="sidebar-link group flex items-center px-3 py-3 text-base rounded-lg"><i data-lucide="user" class="ml-3 h-5 w-5"></i>الملف الشخصي</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </nav>
    
    <!-- Mobile Sidebar -->
    <div id="mobileMenuOverlay" class="fixed inset-0 z-40 lg:hidden hidden">
        <div class="fixed inset-0 bg-gray-600 bg-opacity-75" aria-hidden="true"></div>
        <nav class="fixed top-0 right-0 bottom-0 flex flex-col w-5/6 max-w-sm py-6 shadow-xl overflow-y-auto" style="background-color: #1a2b4a;">
            <div class="px-4 pb-4 flex items-center justify-between border-b border-white/10">
                <div class="flex items-center">
                    <img src="https://r2.flowith.net/files/o/1748451765656-Modern_Logo_Design_for_Madarek_School_Management_Platform_index_0@1024x1024.png" alt="مدارك" class="h-8 w-auto rounded-full">
                    <span class="mr-2 text-lg font-bold text-white">مدارِك</span>
                </div>
                <button id="closeMobileMenuButton" class="p-2 text-text-secondary hover:text-text-primary">
                    <i data-lucide="x" class="h-6 w-6"></i>
                </button>
            </div>
            <nav class="mt-5 px-4 flex-1">
                 <ul class="space-y-1">
                    <li><a href="index.html" class="sidebar-link group flex items-center px-3 py-3 text-base font-semibold rounded-lg"><i data-lucide="layout-dashboard" class="ml-3 h-5 w-5"></i>لوحة التحكم</a></li>
                    <li><a href="lessons.html" class="sidebar-link group flex items-center px-3 py-3 text-base rounded-lg"><i data-lucide="book-open" class="ml-3 h-5 w-5"></i>الدروس والمواد</a></li>
                    <li><a href="schedule.html" class="sidebar-link group flex items-center px-3 py-3 text-base rounded-lg"><i data-lucide="calendar-days" class="ml-3 h-5 w-5"></i>الجدول الدراسي</a></li>
                    <li><a href="attendence.html" class="sidebar-link group flex items-center px-3 py-3 text-base rounded-lg active"><i data-lucide="calendar-check" class="ml-3 h-5 w-5"></i>الحضور</a></li>
                    <li><a href="grades.html" class="sidebar-link group flex items-center px-3 py-3 text-base rounded-lg"><i data-lucide="bar-chart-3" class="ml-3 h-5 w-5"></i>الصحيفة</a></li>
                    <li><a href="profile.html" class="sidebar-link group flex items-center px-3 py-3 text-base rounded-lg"><i data-lucide="user" class="ml-3 h-5 w-5"></i>الملف الشخصي</a></li>
                </ul>
            </nav>
        </nav>
    </div>
    <!-- Main content area -->
    <div class="flex-1 flex flex-col overflow-hidden">
        <!-- Header -->
        <header class="bg-card shadow-sm border-b border-gray-200 sticky top-0 z-30">
            <div class="mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-20">
                     <div class="flex items-center">
                        <button id="mobileMenuButton" class="p-2 text-text-secondary hover:text-text-primary lg:hidden">
                            <i data-lucide="menu" class="h-6 w-6"></i>
                        </button>
                         <h1 class="text-2xl font-bold text-text-primary hidden lg:block">مدرسة الصِّدِيقة</h1>
                    </div>
                    
                    <div class="flex items-center space-x-4 space-x-reverse">
                         <!-- Notification Dropdown -->
                        <div class="relative">
                            <button id="notificationButton" title="الإشعارات" class="p-2 text-text-secondary hover:text-text-primary relative rounded-full hover:bg-gray-100 transition-colors">
                                <i data-lucide="bell" class="h-6 w-6"></i>
                                <span class="absolute top-2 right-2 block h-2.5 w-2.5 rounded-full bg-danger ring-2 ring-card"></span>
                            </button>
                            <div id="notificationMenu" class="hidden absolute left-0 mt-2 w-80 rounded-md shadow-lg bg-card ring-1 ring-black ring-opacity-5 z-50">
                                <div class="p-3 font-bold text-text-primary border-b border-gray-100">
                                    الإشعارات
                                </div>
                                <div id="notification-list-container" class="py-1">
                                    <a href="#" class="flex items-start px-4 py-3 text-sm text-text-primary hover:bg-gray-100 transition-colors">
                                        <div class="p-2 bg-primary bg-opacity-10 rounded-full ml-3">
                                            <i data-lucide="notebook-tabs" class="w-5 h-5 text-primary"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold">تم إضافة واجب منزلي جديد في مادة الرياضيات.</p>
                                            <span class="text-xs text-text-secondary">منذ 5 دقائق</span>
                                        </div>
                                    </a>
                                    <a href="#" class="flex items-start px-4 py-3 text-sm text-text-primary hover:bg-gray-100 transition-colors">
                                        <div class="p-2 bg-accent bg-opacity-10 rounded-full ml-3">
                                            <i data-lucide="message-square" class="w-5 h-5 text-accent"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold">رسالة جديدة من <span class="text-accent">المعلم أحمد</span>.</p>
                                            <span class="text-xs text-text-secondary">منذ 20 دقيقة</span>
                                        </div>
                                    </a>
                                    <a href="#" class="flex items-start px-4 py-3 text-sm text-text-primary hover:bg-gray-100 transition-colors">
                                         <div class="p-2 bg-warning bg-opacity-10 rounded-full ml-3">
                                            <i data-lucide="calendar-check" class="w-5 h-5 text-orange"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold">تذكير باختبار العلوم غدًا.</p>
                                             <span class="text-xs text-text-secondary">أمس، 8:00م</span>
                                        </div>
                                    </a>
                                    <a href="#" class="flex items-start px-4 py-3 text-sm text-text-primary hover:bg-gray-100 transition-colors">
                                        <div class="p-2 bg-primary bg-opacity-10 rounded-full ml-3">
                                            <i data-lucide="notebook-tabs" class="w-5 h-5 text-primary"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold">تم إضافة واجب منزلي جديد في مادة الرياضيات.</p>
                                            <span class="text-xs text-text-secondary">منذ 5 دقائق</span>
                                        </div>
                                    </a>
                                    <a href="#" class="flex items-start px-4 py-3 text-sm text-text-primary hover:bg-gray-100 transition-colors">
                                        <div class="p-2 bg-accent bg-opacity-10 rounded-full ml-3">
                                            <i data-lucide="message-square" class="w-5 h-5 text-accent"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold">رسالة جديدة من <span class="text-accent">المعلم أحمد</span>.</p>
                                            <span class="text-xs text-text-secondary">منذ 20 دقيقة</span>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <div class="relative">
                            <button id="userMenuButton" class="flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                                <div class="h-10 w-10 rounded-full bg-primary text-white flex items-center justify-center text-lg font-bold">ط</div>
                                <span class="mr-3 text-text-primary font-semibold hidden sm:block">الطالب</span>
                                <i data-lucide="chevron-down" class="w-4 h-4 mr-1 text-text-secondary hidden sm:block"></i>
                            </button>
                            <div id="userMenu" class="hidden absolute left-0 mt-2 w-48 rounded-md shadow-lg bg-card ring-1 ring-black ring-opacity-5 z-50">
                                <div class="py-1">
                                    <a href="profile.html" class="block px-4 py-2 text-sm text-text-primary hover:bg-gray-100">الملف الشخصي</a>
                                    <div class="border-t border-gray-100"></div>
                                    <a href="#" class="block px-4 py-2 text-sm text-danger hover:bg-red-50">تسجيل الخروج</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <main class="flex-1 overflow-y-auto focus:outline-none p-6 lg:p-8">
            <section>
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center">
                        <div class="bg-gradient-to-r from-primary to-accent p-2 rounded-full ml-3 shadow-md">
                            <i data-lucide="calendar-check" class="h-6 w-6 text-white"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-text-primary">الحضور</h2>
                    </div>
                    
                    <!-- Month Selector -->
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <button id="prevMonth" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                            <i data-lucide="chevron-right" class="h-5 w-5 text-text-secondary"></i>
                        </button>
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <select id="monthSelect" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="0">يناير</option>
                                <option value="1">فبراير</option>
                                <option value="2">مارس</option>
                                <option value="3">أبريل</option>
                                <option value="4">مايو</option>
                                <option value="5">يونيو</option>
                                <option value="6">يوليو</option>
                                <option value="7">أغسطس</option>
                                <option value="8">سبتمبر</option>
                                <option value="9">أكتوبر</option>
                                <option value="10">نوفمبر</option>
                                <option value="11">ديسمبر</option>
                            </select>
                            <select id="yearSelect" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="2024">2024</option>
                                <option value="2025">2025</option>
                                <option value="2026">2026</option>
                            </select>
                        </div>
                        <button id="nextMonth" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                            <i data-lucide="chevron-left" class="h-5 w-5 text-text-secondary"></i>
                        </button>
                    </div>
                </div>

                <!-- Attendance Summary -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-card p-4 rounded-lg shadow-sm border border-gray-200">
                        <div class="flex items-center">
                            <div class="p-2 bg-success bg-opacity-10 rounded-full ml-3">
                                <i data-lucide="check-circle" class="h-5 w-5 text-success"></i>
                            </div>
                            <div>
                                <p class="text-sm text-text-secondary">أيام الحضور</p>
                                <p class="text-xl font-bold text-success" id="presentDays">18</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-card p-4 rounded-lg shadow-sm border border-gray-200">
                        <div class="flex items-center">
                            <div class="p-2 bg-danger bg-opacity-10 rounded-full ml-3">
                                <i data-lucide="x-circle" class="h-5 w-5 text-danger"></i>
                            </div>
                            <div>
                                <p class="text-sm text-text-secondary">أيام الغياب</p>
                                <p class="text-xl font-bold text-danger" id="absentDays">2</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Calendar -->
                <div class="bg-card rounded-xl shadow-lg border border-gray-200 overflow-hidden">
                    <div class="p-6">
                        <div class="grid grid-cols-7 gap-1">
                            <!-- Calendar Headers -->
                            <div class="p-3 text-center font-bold text-text-secondary text-sm">الأحد</div>
                            <div class="p-3 text-center font-bold text-text-secondary text-sm">الإثنين</div>
                            <div class="p-3 text-center font-bold text-text-secondary text-sm">الثلاثاء</div>
                            <div class="p-3 text-center font-bold text-text-secondary text-sm">الأربعاء</div>
                            <div class="p-3 text-center font-bold text-text-secondary text-sm">الخميس</div>
                            <div class="p-3 text-center font-bold text-text-secondary text-sm">الجمعة</div>
                            <div class="p-3 text-center font-bold text-text-secondary text-sm">السبت</div>
                            
                            <!-- Calendar Days -->
                            <div id="calendarDays" class="col-span-7 grid grid-cols-7 gap-1">
                                <!-- Calendar days will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Legend -->
                <div class="mt-6 bg-card p-4 rounded-lg shadow-sm border border-gray-200">
                    <h3 class="text-lg font-semibold text-text-primary mb-3">دليل الألوان</h3>
                    <div class="flex flex-wrap gap-4">
                        <div class="flex items-center">
                            <div class="w-4 h-4 bg-success rounded-full ml-2"></div>
                            <span class="text-sm text-text-secondary">حضور</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-4 h-4 bg-danger rounded-full ml-2"></div>
                            <span class="text-sm text-text-secondary">غياب</span>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>
</div>

<script>
// Calendar functionality
class AttendanceCalendar {
    constructor() {
        this.currentDate = new Date();
        this.selectedMonth = this.currentDate.getMonth();
        this.selectedYear = this.currentDate.getFullYear();
        
        this.init();
    }
    
    init() {
        this.setupEventListeners();
        this.updateCalendar();
        this.updateSummary();
    }
    
    setupEventListeners() {
        document.getElementById('prevMonth').addEventListener('click', () => {
            this.selectedMonth--;
            if (this.selectedMonth < 0) {
                this.selectedMonth = 11;
                this.selectedYear--;
            }
            this.updateCalendar();
            this.updateSummary();
        });
        
        document.getElementById('nextMonth').addEventListener('click', () => {
            this.selectedMonth++;
            if (this.selectedMonth > 11) {
                this.selectedMonth = 0;
                this.selectedYear++;
            }
            this.updateCalendar();
            this.updateSummary();
        });
        
        document.getElementById('monthSelect').addEventListener('change', (e) => {
            this.selectedMonth = parseInt(e.target.value);
            this.updateCalendar();
            this.updateSummary();
        });
        
        document.getElementById('yearSelect').addEventListener('change', (e) => {
            this.selectedYear = parseInt(e.target.value);
            this.updateCalendar();
            this.updateSummary();
        });
    }
    
    updateCalendar() {
        const calendarDays = document.getElementById('calendarDays');
        const monthSelect = document.getElementById('monthSelect');
        const yearSelect = document.getElementById('yearSelect');
        
        // Update selectors
        monthSelect.value = this.selectedMonth;
        yearSelect.value = this.selectedYear;
        
        // Get first day of month and number of days
        const firstDay = new Date(this.selectedYear, this.selectedMonth, 1);
        const lastDay = new Date(this.selectedYear, this.selectedMonth + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDay = firstDay.getDay(); // 0 = Sunday, 1 = Monday, etc.
        
        // Clear calendar
        calendarDays.innerHTML = '';
        
        // Add empty cells for days before the first day of the month
        for (let i = 0; i < startingDay; i++) {
            const emptyDay = document.createElement('div');
            emptyDay.className = 'p-3 text-center text-gray-300';
            calendarDays.appendChild(emptyDay);
        }
        
        // Add days of the month
        for (let day = 1; day <= daysInMonth; day++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'p-3 text-center border border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors';
            
            const attendanceStatus = this.getAttendanceStatus(day);
            const statusClass = this.getStatusClass(attendanceStatus);
            
            dayElement.innerHTML = `
                <div class="text-sm font-semibold text-text-primary">${day}</div>
                <div class="w-2 h-2 mx-auto mt-1 rounded-full ${statusClass}"></div>
            `;
            
            // Add tooltip with attendance details
            dayElement.title = this.getAttendanceTooltip(day, attendanceStatus);
            
            calendarDays.appendChild(dayElement);
        }
    }
    
    getAttendanceStatus(day) {
        // Simulate attendance data - in real app this would come from API
        const date = new Date(this.selectedYear, this.selectedMonth, day);
        const dayOfWeek = date.getDay();
        
        // Skip weekends (Friday = 5, Saturday = 6)
        if (dayOfWeek === 5 || dayOfWeek === 6) {
            return 'weekend';
        }
        
        // Simulate some attendance patterns
        const random = Math.random();
        if (random < 0.85) {
            return 'present';
        } else if (random < 0.95) {
            return 'late';
        } else {
            return 'absent';
        }
    }
    
    getStatusClass(status) {
        switch (status) {
            case 'present':
                return 'bg-success';
            case 'absent':
                return 'bg-danger';
            case 'late':
                return 'bg-warning';
            case 'weekend':
                return 'bg-gray-100';
            default:
                return 'bg-gray-300';
        }
    }
    
    getAttendanceTooltip(day, status) {
        const date = new Date(this.selectedYear, this.selectedMonth, day);
        const dayNames = ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
        const dayName = dayNames[date.getDay()];
        
        switch (status) {
            case 'present':
                return `${dayName} ${day}: حضور`;
            case 'absent':
                return `${dayName} ${day}: غياب`;
            case 'late':
                return `${dayName} ${day}: تأخير`;
            case 'weekend':
                return `${dayName} ${day}: إجازة نهاية الأسبوع`;
            default:
                return `${dayName} ${day}: غير محدد`;
        }
    }
    
    updateSummary() {
        // Calculate attendance statistics
        let present = 0, absent = 0, late = 0, total = 0;
        
        const lastDay = new Date(this.selectedYear, this.selectedMonth + 1, 0);
        const daysInMonth = lastDay.getDate();
        
        for (let day = 1; day <= daysInMonth; day++) {
            const status = this.getAttendanceStatus(day);
            if (status !== 'weekend') {
                total++;
                switch (status) {
                    case 'present':
                        present++;
                        break;
                    case 'absent':
                        absent++;
                        break;
                    case 'late':
                        late++;
                        break;
                }
            }
        }
        
        const rate = total > 0 ? Math.round((present / total) * 100) : 0;
        
        // Update summary display
        document.getElementById('presentDays').textContent = present;
        document.getElementById('absentDays').textContent = absent;
        document.getElementById('lateDays').textContent = late;
        document.getElementById('attendanceRate').textContent = `${rate}%`;
    }
}

// Initialize calendar when page loads
document.addEventListener('DOMContentLoaded', () => {
    new AttendanceCalendar();
});
</script>

<script src="script.js"></script>
</body>
</html>
